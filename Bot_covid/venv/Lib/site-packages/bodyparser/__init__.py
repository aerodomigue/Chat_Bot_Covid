from urllib import parse

def bodyparser(body):
	ht={};
	b=body;
	try:
		b=b.decode("utf-8");
	except Exception as e:
		b=b;
	b=b.replace("+"," ");
	if len(b)>0:
		h=b.split("&");
		for k in h:
			htt=k.split("=");
			f="";
			i=1;
			while i<len(htt):
				f=f+parse.unquote(htt[i])#.replace('"',r'\"').replace("'",r"\'");		
				if len(htt)>2:
					f=f+"=";
				ky=parse.unquote(htt[0]);
				f=parse.unquote(f).replace('"',r'\"').replace("'",r"\'");
				if ky.find('[')!=-1 and ky.find(']')!=-1:
					d=ky.split('[');	
					d=[k.replace(']','') for k in d]
					x=False;
					for o in d:
						if o.isnumeric():
							x=True;
							pass;

					s="ht";
					i=0;
					excscr="";
					p='';
					while i<len(d):
						g=s;
						if x:
							e=0;
							r=0;

							if d[i].isnumeric():
								s=s+"['"+d[i-1]+"']";
								excscr="if '"+d[i-1]+"' not in "+g+":\n	"+s+"=[]";
								e=d[i];
								r=i;
								p=s;
								s=s+"["+str(e)+"]";
							elif d[i]=='':
								p=s;
								s=s+"['"+d[i-1]+"']";
								excscr="if '"+d[i-1]+"' not in "+p+":\n	"+s+"=[]; \n"+s+".append("+f+");";
								i=i+1;
							elif i<len(d) and i==len(d)-1:
								if len(f)==0:
									excscr="if len("+p+")!="+str(e+1)+":\n	"+p+".append({});\n"+s+"['"+d[i]+"']=None; ";
								else:
									excscr="if len("+p+")!="+str(e+1)+":\n	"+p+".append({});\n"+s+"['"+d[i]+"']='"+f+"'; ";
							elif i!=len(d)-1 and d[i+1].isnumeric()==False and d[i+1]!='':
								g=s;
								s=s+"['"+d[i]+"']";
								excscr="if '"+d[i]+"' not in "+g+":\n	"+s+"={}";
						elif x==0:
							if d.count('')>0:
									p=s;
									s=s+"['"+d[i]+"']";
									excscr="if '"+d[i]+"' not in "+p+":\n	"+s+"=[]; \n"+s+".append("+f+");";
									i=i+1;
							else:
								if len(d)-1!=i:
									s=s+"['"+d[i]+"']";
									excscr="if '"+d[i]+"' not in "+g+":\n	"+s+"={}";
								else:
									s=s+"['"+d[i]+"']";
									if len(f)>0:
										excscr=s+"='"+f+"'";
									else:
										excscr=s+"=None";								
						exec(excscr);			
						i=i+1;
				else:
					if len(f)>0:
						ht[ky]=f;
					else:
						ht[ky]=None;
				i=i+1;
	return ht


	
	